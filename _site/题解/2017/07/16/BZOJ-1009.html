<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>[BZOJ]1009</title>
  <meta name="description" content="Description　阿申准备报名参加GT考试，准考证号为N位数X1X2....Xn(0&lt;=Xi&lt;=9),他不希望准考证号上出现不吉利的数字。他的不吉利数学A1A2...Am(0&lt;=Ai&lt;=9)有M位，不出现是指X1X2...Xn中没有恰好一段等于A1A2...Am. A1和X1可以为0...">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/%E9%A2%98%E8%A7%A3/2017/07/16/BZOJ-1009.html">
  <link rel="alternate" type="application/rss+xml" title="sssSSSay" href="http://localhost:4000/feed.xml" />
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">sssSSSay</a>

    <nav class="site-nav">
        
          
          <a class="page-link" href="/about.html">About</a>
          
        
          
        
          
          <a class="page-link" href="/links.html">Links</a>
          
        
          
        
    </nav>

  </div>

</header>


    <div class="page-content">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">[BZOJ]1009</h1>
    <p class="post-meta">Jul 16, 2017</p>
  </header>

  <article class="post-content">
    <h4 id="description">Description</h4>
<p>　<code class="highlighter-rouge">阿申准备报名参加GT考试，准考证号为N位数X1X2....Xn(0&lt;=Xi&lt;=9),他不希望准考证号上出现不吉利的数字。
他的不吉利数学A1A2...Am(0&lt;=Ai&lt;=9)有M位，不出现是指X1X2...Xn中没有恰好一段等于A1A2...Am. A1和X1可以为0</code></p>
<h4 id="input">Input</h4>
<p>　<code class="highlighter-rouge">第一行输入N,M,K.接下来一行输入M位的数。 N&lt;=10^9,M&lt;=20,K&lt;=1000</code></p>
<h4 id="output">Output</h4>
<p>　<code class="highlighter-rouge">阿申想知道不出现不吉利数字的号码有多少种，输出模K取余的结果.</code></p>
<h4 id="sample-input">Sample Input</h4>
<p>　<code class="highlighter-rouge">4 3 100
　111</code></p>
<h4 id="sample-output">Sample Output</h4>
<p>　<code class="highlighter-rouge">81</code></p>

<h2 id="题解">题解</h2>
<p>　<del>蒟蒻膜拜神题</del>  
　奉上大牛博客 <a href="http://blog.csdn.net/cjk_cjk/article/details/43038377">Here</a>    
像这种题如果没有见过能做出来是万分厉害的%%%   <br />
<del>反正我不会</del> 用到了Kmp一类的Dp 需要一些经验才能对这种题有感觉 <br />
f[i][j]意为以准考证中的地i位为结尾的后缀已经匹配到了不吉利串以j为结尾的前缀的方案数(这口气好长)  
　答案就是<script type="math/tex">sum_{i=0}^{m-1}f[n][i]</script>显然    
那么我们考虑如何转移 我们考虑从前面“要” <br />
<script type="math/tex">f[i][j] = \sum_{k=0}^{m-1}(f[i-1][k] * a[k][j])</script>    
　这个乱七八糟的式子是什么东西呢?考虑在已知f[i-1][k]的答案后再i-1的后面加了一个数字    
加了一个数字后变成了i(加了一个) 那么是不是f[i][j] = f[i-1][k]?   <br />
当然不是 加了这个数字是未知的 但我们知道只有0~9这十个数字 加了不同的数字会让f[i-1][k]中的k变成不同的值(即匹配的位数会有变化)   <br />
那么a[k][j]这个a数组代表当i-1状态匹配了k位 在i-1后面任意加一个数字x致使可以匹配j位 这个x的个数 <br />
现在只要我们有了这个a数组就可以很方便的转移 那么a怎么求呢  
　很好求 <del>一眼看上去</del>可以知道上述a数组的功能其实就是一个next表(Kmp中的那个)  
<del>我不讲Kmp</del>这样就可以通过对不吉利串来处理出一个a数组 然后进行转移  
　似乎问题已经解决 但是数据范围?N &lt;= 10 ^ 9 …    
<del>好的此题不可做大家散了吧</del>    
　恩我们观察这个转移式子 sigma f[i-1][k] * a[k][j] 多么像矩阵乘法的形式！而且每次转移乘的都是同一个a数组！  
我们把f看成矩阵A a看成矩阵B 那么A * B就是一次转移  
　A * B * B * B * B …如此乘很多次就可以得到最后的答案 而矩阵乘满足结合律 对B矩阵快速幂再与A相乘即可  
最后答案取$\sum_{i=0}^{m-1}f[0][k]$初值f[0][0] = 1    
　我们总结一些：Kmp预处理 + Dp + 矩阵乘法快速幂    
再次%   <br />
下面上代码</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include &lt;cstdio&gt;
#include &lt;cstring&gt;
#include &lt;iostream&gt;
</span><span class="c1">//方程 : dp[i][j] = Sigma ( dp[i-1][k] * a[k][j] ).0&lt;=k&lt;=m-1
//这个式子其实是dp数组和a数组的矩阵乘 所以可以写成dp = dp * a
//最后快速幂加速 --- sssSSSay
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">M</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">dp</span><span class="p">[</span><span class="n">M</span><span class="p">][</span><span class="n">M</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">M</span><span class="p">][</span><span class="n">M</span><span class="p">],</span><span class="n">next</span><span class="p">[</span><span class="n">M</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">s</span><span class="p">[</span><span class="n">M</span><span class="p">];</span>

<span class="kt">void</span> <span class="n">Mul</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="n">M</span><span class="p">][</span><span class="n">M</span><span class="p">],</span><span class="kt">int</span> <span class="n">b</span><span class="p">[</span><span class="n">M</span><span class="p">][</span><span class="n">M</span><span class="p">],</span><span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">M</span><span class="p">][</span><span class="n">M</span><span class="p">]){</span><span class="c1">//矩阵乘法
</span>    <span class="kt">int</span> <span class="n">d</span><span class="p">[</span><span class="n">M</span><span class="p">][</span><span class="n">M</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">k</span><span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">%</span> <span class="n">p</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(){</span>
    <span class="n">freopen</span><span class="p">(</span><span class="s">"bzoj_1009.in"</span><span class="p">,</span><span class="s">"r"</span><span class="p">,</span><span class="n">stdin</span><span class="p">);</span>
    <span class="n">freopen</span><span class="p">(</span><span class="s">"bzoj_1009.out"</span><span class="p">,</span><span class="s">"w"</span><span class="p">,</span><span class="n">stdout</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%d%d%d"</span><span class="p">,</span><span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="o">&amp;</span><span class="n">m</span><span class="p">,</span><span class="o">&amp;</span><span class="n">p</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="c1">//处理Next表
</span>        <span class="k">while</span><span class="p">(</span><span class="n">j</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span><span class="n">j</span> <span class="o">=</span> <span class="n">next</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span><span class="n">j</span><span class="o">++</span><span class="p">;</span><span class="n">next</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="c1">//枚举在哪一位失配
</span>        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="mi">9</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span><span class="c1">//枚举这一位准考证是什么
</span>            <span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span><span class="k">while</span><span class="p">(</span><span class="n">t</span><span class="o">&gt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="sc">'0'</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span><span class="n">t</span> <span class="o">=</span> <span class="n">next</span><span class="p">[</span><span class="n">t</span><span class="p">];</span><span class="c1">//找匹配在哪里
</span>            <span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="sc">'0'</span> <span class="o">==</span> <span class="n">j</span><span class="p">)</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">++</span><span class="p">;</span><span class="c1">//由i转移到t的数+1
</span>            <span class="k">else</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">++</span><span class="p">;</span><span class="c1">//重新到第一位 即无法匹配
</span>        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="c1">//初始化
</span>    <span class="k">while</span><span class="p">(</span><span class="n">n</span><span class="p">){</span><span class="c1">//快速幂
</span>        <span class="k">if</span><span class="p">(</span><span class="n">n</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span><span class="n">Mul</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">dp</span><span class="p">);</span>
        <span class="n">Mul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">);</span>
        <span class="n">n</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span><span class="kt">int</span> <span class="n">Sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">Sum</span> <span class="o">=</span> <span class="p">(</span><span class="n">Sum</span> <span class="o">+</span> <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">%</span> <span class="n">p</span><span class="p">;</span><span class="c1">//最后一个阶段的所有状态相加即为答案
</span>    <span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">Sum</span><span class="p">);</span>
    <span class="c1">// while(1);
</span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>


  </article>
  <div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2063328"></script>
</div>
<script src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

    </div>
    <div id="analytics">
    <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1261323014'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/z_stat.php%3Fid%3D1261323014%26online%3D2' type='text/javascript'%3E%3C/script%3E"));</script>
</div>
  </body>

</html>
